# 音频交错处理器

专业的立体声音频处理工具，支持基于静音检测的智能分段和交叉淡入淡出处理。

## 功能特性

- 🎚️ 独立声道处理
- 🔇 自适应静音检测
- ✂️ 上下文感知音频分段
- 🔀 智能声道交错
- 🎛️ 原生WAV格式保持
- ⏳ 处理进度可视化
- 🧹 自动资源清理

## 系统要求

- Python 3.8+
- FFmpeg 4.3+
- 存储空间：输入文件大小的3倍（用于临时处理）

## 安装说明

1. 克隆仓库：

    ```bash
    git clone https://github.com/Track07-cda/audio-interlace.git
    cd audio-interlace
    ```

2. 安装依赖项：

    ```bash
    pip install -r requirements.txt
    ```

3. 验证FFmpeg安装：

    ```bash
    ffmpeg -version
    ```

## 基础用法

### 命令模板

```bash
python audio_interlace.py -i 输入文件.wav -o 输出文件.wav [选项]
```

### 示例执行

```bash
python audio_interlace.py \
  -i 输入音频.wav \
  -o 处理结果.wav \
  --fade 300 \
  --min-segment 0.8 \
  --min-silence 0.4
```

## 格式支持说明

**当前仅支持WAV格式**  

- 输入文件必须为标准WAV格式
- 输出文件将生成WAV格式
- 保持原始PCM特性：
  - 采样率（44.1k-384kHz）
  - 位深度（16/24/32-bit）
  - 声道配置

## 处理流程示例

### 1. 声道分段结果

#### 左声道片段

| 片段 | 起始时间 | 结束时间 | 时长   |
|-----|----------|----------|--------|
| L1  | 00:00.0  | 00:12.5  | 12.5秒 |
| L2  | 00:12.5  | 00:25.8  | 13.3秒 |
| L3  | 00:25.8  | 00:38.2  | 12.4秒 |

#### 右声道片段

| 片段 | 起始时间 | 结束时间 | 时长   |
|-----|----------|----------|--------|
| R1  | 00:00.0  | 00:15.2  | 15.2秒 |
| R2  | 00:15.2  | 00:32.0  | 16.8秒 |

### 2. 交错输出序列

| 顺序 | 声道  | 片段 | 时间范围        | 淡入淡出时长     |
|-----|-------|-----|-----------------|------------------|
| 1   | 左声道 | L1  | 00:00-00:12.5   | 12.5秒 (+300毫秒)|
| 2   | 右声道 | R1  | 00:00-00:15.2   | 15.2秒 (+300毫秒)|
| 3   | 左声道 | L2  | 00:12.5-00:25.8 | 13.3秒 (+300毫秒)|
| 4   | 右声道 | R2  | 00:15.2-00:32.0 | 16.8秒 (+300毫秒)|
| 5   | 左声道 | L3  | 00:25.8-00:38.2 | 12.4秒 (+300毫秒)|

**核心特性**：

- 总输出时长：70.2秒（原始35.1秒的2倍）
- 自动添加片段间淡入淡出效果
- 智能处理声道片段数量不均情况
- 时间标记保持原始音频上下文

## 参数参考

| 选项              | 默认值  | 描述                       |
|-------------------|---------|----------------------------|
| `-i/--input`      | 必填    | 输入WAV文件路径            |
| `-o/--output`     | 必填    | 输出WAV文件路径            |
| `--fade`          | 500     | 淡入淡出时长（毫秒）       |
| `--min-segment`   | 1.0     | 最小有效片段时长（秒）     |
| `--min-silence`   | 0.5     | 静音检测阈值时长（秒）     |
| `--noise-level`   | -30     | 静音噪声阈值（dB）         |
| `--temp-dir`      | temp    | 自定义临时目录路径         |
| `--keep-temp`     | False   | 保留中间处理文件           |

## 处理流程

1. **声道分离**  
   - 将立体声输入分离为独立单声道
   - 保持原始PCM参数

2. **自适应分段**  
   - 检测自然停顿点
   - 应用最小时长限制
   - 生成片段元数据

3. **片段处理**  
   - 应用配置的淡入淡出效果
   - 保持原始WAV参数
   - 存储处理后的片段

4. **交错合成**  
   - 按L-R-L-R模式交替声道片段
   - 处理不均衡片段数量
   - 生成最终合并列表

5. **输出生成**  
   - 使用FFmpeg合成最终WAV文件
   - 自动清理临时资源

## 许可证

MIT 许可证 - 详见 [LICENSE](LICENSE)
